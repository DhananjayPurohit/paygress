# NGINX Ingress with Paygress Plugin
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: paygress-ingress
  namespace: paygress-test
  annotations:
    # Use auth_request to call Paygress sidecar
    nginx.ingress.kubernetes.io/auth-url: "http://localhost:3000/auth"
    nginx.ingress.kubernetes.io/auth-method: "GET"
    nginx.ingress.kubernetes.io/auth-signin: "http://localhost:3000/auth"
    nginx.ingress.kubernetes.io/auth-response-headers: "X-Payment-Verified"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      # Custom error responses for payment failures
      error_page 401 402 = @payment_required;
      
      location @payment_required {
          add_header Content-Type application/json always;
          return 402 '{"error":"Payment Required","message":"Send valid Cashu token in Authorization header","amount":1000,"example":"Authorization: Bearer cashu_token_1000_demo"}';
      }

spec:
  ingressClassName: nginx
  rules:
  - host: localhost
    http:
      paths:
      - path: /premium
        pathType: Prefix
        backend:
          service:
            name: test-backend-service
            port:
              number: 80
